<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Twitch Streamer Widget</title>
</head>
<body>
	<script>
// HTML structure for the widget
const widgetHTML = `
  <div id="input-section" style="margin-bottom: 10px;">
    <input id="streamer-input" type="text" placeholder="Enter streamer name" style="padding: 5px; width: 150px;" />
    <button id="load-button" style="padding: 5px;">Load</button>
    <button id="copy-button" style="padding: 5px; margin-left: 5px;">Copy Link</button>
  </div>
  <div id="twitch-widget" style="border: 1px solid #ccc; padding: 10px; width: 200px; font-family: Arial, sans-serif;">
    <img id="avatar" src="" alt="Streamer Avatar" style="width: 50px; height: 50px; border-radius: 50%; display: none; margin-bottom: 5px;" /> <!-- Avatar placeholder -->
    <h3 id="streamer-name">Loading...</h3> <!-- Default loading text for streamer name -->
    <p id="rank">Rank: --</p> <!-- Placeholder for rank -->
    <p id="max-viewers">Max Viewers: --</p> <!-- Placeholder for max viewers data -->
    <p id="avg-viewers">Avg Viewers: --</p> <!-- Placeholder for average viewers -->
    <p id="minutes-streamed">Minutes Streamed: --</p> <!-- Placeholder for minutes streamed -->
    <p id="hours-watched">Hours Watched: --</p> <!-- Placeholder for hours watched -->
    <p id="followers">Followers: --</p> <!-- Placeholder for followers count -->
    <p id="followers-total">Total Followers: --</p> <!-- Placeholder for total followers -->
  </div>
`;

// Insert the widget's HTML into the body of the page
document.body.innerHTML = widgetHTML;

// Function to fetch TwitchTracker API data for a specific user
async function fetchTwitchData(username) {
  try {
    const response = await fetch(`https://twitchtracker.com/api/channels/summary/${username}`);

    if (!response.ok) {
      throw new Error('Error fetching data. Streamer may not exist.');
    }

    const data = await response.json();
    const { rank, max_viewers, avg_viewers, minutes_streamed, hours_watched, followers, followers_total, avatar } = data;

    document.getElementById('streamer-name').textContent = username;
    document.getElementById('rank').textContent = `Rank: ${rank ?? 'N/A'}`;
    document.getElementById('max-viewers').textContent = `Max Viewers: ${max_viewers ?? 'N/A'}`;
    document.getElementById('avg-viewers').textContent = `Avg Viewers: ${avg_viewers ?? 'N/A'}`;
    document.getElementById('minutes-streamed').textContent = `Minutes Streamed: ${minutes_streamed ?? 'N/A'}`;
    document.getElementById('hours-watched').textContent = `Hours Watched: ${hours_watched ?? 'N/A'}`;
    document.getElementById('followers').textContent = `Followers: ${followers ?? 'N/A'}`;
    document.getElementById('followers-total').textContent = `Total Followers: ${followers_total ?? 'N/A'}`;

    if (avatar) {
      const avatarImg = document.getElementById('avatar');
      avatarImg.src = avatar;
      avatarImg.style.display = 'block';
    }
  } catch (error) {
    document.getElementById('streamer-name').textContent = 'Error';
    document.getElementById('rank').textContent = '';
    document.getElementById('max-viewers').textContent = error.message;
    document.getElementById('avg-viewers').textContent = '';
    document.getElementById('minutes-streamed').textContent = '';
    document.getElementById('hours-watched').textContent = '';
    document.getElementById('followers').textContent = '';
    document.getElementById('followers-total').textContent = '';
  }
}

// Event listener to load streamer data when button is clicked
document.getElementById('load-button').addEventListener('click', () => {
  const streamerName = document.getElementById('streamer-input').value.trim();
  if (streamerName) fetchTwitchData(streamerName);
});

// Event listener to copy a unique link to the clipboard
document.getElementById('copy-button').addEventListener('click', () => {
  const streamerName = document.getElementById('streamer-input').value.trim();
  if (streamerName) {
    const uniqueLink = `${window.location.origin}?streamer=${encodeURIComponent(streamerName)}`;
    navigator.clipboard.writeText(uniqueLink).then(() => {
      alert('Link copied to clipboard: ' + uniqueLink);
    }).catch(() => {
      alert('Failed to copy link.');
    });
  } else {
    alert('Please enter a streamer name first.');
  }
});

// Automatically load data if a streamer parameter exists in the URL
const urlParams = new URLSearchParams(window.location.search);
const streamerFromURL = urlParams.get('streamer');
if (streamerFromURL) {
  document.getElementById('streamer-input').value = streamerFromURL;
  fetchTwitchData(streamerFromURL);
}

	</script>
</body>
</html>
